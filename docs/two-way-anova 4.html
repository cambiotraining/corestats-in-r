<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Chapter 20 Two-way ANOVA | Core Statistics in R</title>
<meta name="author" content="Matt Castle and Martin van Rongen">
<meta name="description" content="20.1 Objectives  Questions When is the use of a two-way ANOVA appropriate? How do I perform this in R? Objectives Be able to perform a two-way ANOVA in R Understand the concept of interaction...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 20 Two-way ANOVA | Core Statistics in R">
<meta property="og:type" content="book">
<meta property="og:description" content="20.1 Objectives  Questions When is the use of a two-way ANOVA appropriate? How do I perform this in R? Objectives Be able to perform a two-way ANOVA in R Understand the concept of interaction...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 20 Two-way ANOVA | Core Statistics in R">
<meta name="twitter:description" content="20.1 Objectives  Questions When is the use of a two-way ANOVA appropriate? How do I perform this in R? Objectives Be able to perform a two-way ANOVA in R Understand the concept of interaction...">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Place favicon.ico & apple-touch-icon.png in the root of your domain and delete these references --><link rel="shortcut icon" href="favicon.ico">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<!-- CSS : implied media="all" --><link rel="stylesheet" href="stylesheets/full-stylesheet.css">
<link rel="stylesheet" href="stylesheets/styleguide.css">
<link rel="stylesheet" href="stylesheets/style.css">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><script type="text/javascript" src="//use.typekit.com/hyb5bko.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript">  document.documentElement.className += " js";</script>
</head>
<body class="campl-theme-2" data-spy="scroll" data-target="#toc">

<!--[if lt IE 7]>
<div class="lt-ie9 lt-ie8 lt-ie7">
<![endif]-->
<!--[if IE 7]>
<div class="lt-ie9 lt-ie8">
<![endif]-->
<!--[if IE 8]>
<div class="lt-ie9">
<![endif]-->

	<a href="#primary-nav" class="campl-skipTo">skip to primary navigation</a>
	<a href="#content" class="campl-skipTo">skip to content</a>
	<div class="campl-row campl-global-header">
		<div class="campl-wrap clearfix">
			<div class="campl-header-container campl-column8" id="global-header-controls">
				<a href="http://www.cam.ac.uk" class="campl-main-logo">
					<img alt="University of Cambridge" src="images/interface/main-logo-small.png" height="38px;"></a>

				<ul class="campl-unstyled-list campl-horizontal-navigation campl-global-navigation clearfix">
<li>
						<a href="#study-with-us">Study at Cambridge</a>
					</li>
					<li>
						<a href="#about-the-university">About the University</a>
					</li>
					<li>
						<a href="http://www.cam.ac.uk/research" class="campl-no-drawer">Research at Cambridge</a>
					</li>
				</ul>
</div>

			<div class="campl-column2">
				<div class="campl-quicklinks">
				</div>
			</div>

			<div class="campl-column2">

				<div class="campl-site-search" id="site-search-btn">

					<label for="header-search" class="hidden">Search site</label>
					<div class="campl-search-input">
						<form action="http://search.cam.ac.uk/web" method="get">
						<input id="header-search" type="text" name="query" value="" placeholder="Search"><input type="image" class="campl-search-submit " src="images/interface/btn-search-header.png">
</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="campl-row campl-global-header campl-search-drawer">
		<div class="campl-wrap clearfix">
			<form class="campl-site-search-form" id="site-search-container" action="">
				<div class="campl-search-form-wrapper clearfix">
					<input type="text" class="text" placeholder="Search"><input type="image" class="campl-search-submit" src="images/interface/btn-search.png">
</div>
			</form>
		</div>
	</div>

	<div class="campl-row campl-global-navigation-drawer">

		<div class="campl-wrap clearfix">
			<div class="campl-column12 campl-home-link-container">
				<a href="">Home</a>
			</div>
		</div>
		<div class="campl-wrap clearfix">
			<div class="campl-column12 campl-global-navigation-mobile-list campl-global-navigation-list">
				<div class="campl-global-navigation-outer clearfix" id="study-with-us">
					<ul class="campl-unstyled-list campl-global-navigation-header-container ">
<li><a href="http://www.cam.ac.uk/study-at-cambridge">Study at Cambridge</a></li>
					</ul>
<div class="campl-column4">
						<ul class="campl-global-navigation-container campl-unstyled-list campl-global-navigation-secondary-with-children">
<li>
								<a href="http://www.study.cam.ac.uk/undergraduate/">Undergraduate</a>
								<ul class="campl-global-navigation-tertiary campl-unstyled-list">
<li>
										<a href="http://www.undergraduate.study.cam.ac.uk/courses">Courses</a>
									</li>
									<li>
										<a href="http://www.undergraduate.study.cam.ac.uk/applying">Applying</a>
									</li>
									<li>
										<a href="http://www.undergraduate.study.cam.ac.uk/events">Events and open days</a>
									</li>
								  <li>
										<a href="http://www.undergraduate.study.cam.ac.uk/finance">Fees and finance</a>
									</li>
								  <li>
										<a href="http://www.becambridge.com/">Student blogs and videos</a>
									</li>
								</ul>
</li>
						</ul>
</div>
					<div class="campl-column4">
						<ul class="campl-global-navigation-container campl-unstyled-list campl-global-navigation-secondary-with-children">
<li>
								<a href="http://www.graduate.study.cam.ac.uk/">Graduate</a>
								<ul class="campl-global-navigation-tertiary campl-unstyled-list">
<li>
										<a href="http://www.graduate.study.cam.ac.uk/why-cambridge/welcome-vice-chancellor">Why Cambridge</a>
									</li>
									<li>
										<a href="http://www.graduate.study.cam.ac.uk/courses%0A">Course directory</a>
									</li>
									<li>
									<a href="http://www.graduate.study.cam.ac.uk/how-do-i-apply">How to apply</a>
</li>
									<li><a href="http://www.cambridgestudents.cam.ac.uk/fees-and-funding">Fees and funding</a></li>
									<li><a href="http://www.graduate.study.cam.ac.uk/faqs/applicant">Frequently asked questions</a></li>
								</ul>
</li>
						</ul>
</div>
					<div class="campl-column4">
						<ul class="campl-global-navigation-container campl-unstyled-list last">
<li>
								<a href="http://www.internationalstudents.cam.ac.uk">International students</a>
							</li>
							<li>
								<a href="http://www.ice.cam.ac.uk">Continuing education</a>
							</li>
							<li>
								<a href="http://www.epe.admin.cam.ac.uk/">Executive and professional education</a>
							</li>
							<li>
								<a href="http://www.educ.cam.ac.uk">Courses in education</a>
							</li>
						</ul>
</div>
				</div>

				<div class="campl-global-navigation-outer clearfix" id="about-the-university">
					<ul class="campl-global-navigation-header-container campl-unstyled-list">
<li><a href="http://www.cam.ac.uk/about-the-university">About the University</a></li>
					</ul>
<div class="campl-column4">
						<ul class="campl-global-navigation-container campl-unstyled-list">
<li>
								<a href="http://www.cam.ac.uk/about-the-university/how-the-university-and-colleges-work">How the University and Colleges work</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/about-the-university/history">History</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/about-the-university/visiting-the-university">Visiting the University</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/about-the-university/term-dates-and-calendars">Term dates and calendars</a>
							</li>
							<li class="last">
								<a href="http://map.cam.ac.uk">Map</a>
							</li>
						</ul>
</div>
					<div class="campl-column4">
						<ul class="campl-global-navigation-container campl-unstyled-list">
<li>
								<a href="http://www.communications.cam.ac.uk/">For media</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/video-and-audio">Video and audio</a>
							</li>
							<li>
								<a href="http://webservices.admin.cam.ac.uk/fae/">Find an expert</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/about-the-university/publications">Publications</a>
							</li>
							<li class="last">
								<a href="http://www.cam.ac.uk/global-cambridge">Global Cambridge</a>
							</li>
						</ul>
</div>
					<div class="campl-column4">
						<ul class="campl-global-navigation-container campl-unstyled-list">
<li>
								<a href="http://www.cam.ac.uk/news">News</a>
							</li>
							<li>
								<a href="http://www.admin.cam.ac.uk/whatson/">Events</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/public-engagement">Public engagement</a>
							</li>
							<li>
								<a href="http://www.jobs.cam.ac.uk">Jobs</a>
							</li>
							<li class="last">
								<a href="https://www.philanthropy.cam.ac.uk/">Give to Cambridge</a>
							</li>
						</ul>
</div>
				</div>

				<div class="campl-global-navigation-outer clearfix" id="our-research">
					<ul class="campl-global-navigation-header-container campl-unstyled-list">
<li><a href="">Research at Cambridge</a></li>
					</ul>
</div>
			</div>

			<ul class="campl-unstyled-list campl-quicklinks-list campl-global-navigation-container ">
<li>
					<a href="http://www.cam.ac.uk/for-staff">For staff</a>
				</li>
				<li>
					<a href="http://www.cam.ac.uk/current-students">For current students</a>
				</li>
				<li>
					<a href="http://www.alumni.cam.ac.uk">For alumni</a>
				</li>
				<li>
					<a href="http://www.cam.ac.uk/for-business">For business</a>
				</li>
				<li>
					<a href="http://www.cam.ac.uk/colleges-and-departments">Colleges &amp; departments</a>
				</li>
				<li>
					<a href="http://www.lib.cam.ac.uk/libraries/">Libraries &amp; facilities</a>
				</li>
				<li>
					<a href="http://www.cam.ac.uk/museums-and-collections">Museums &amp; collections</a>
				</li>
				<li class="last">
					<a href="http://www.cam.ac.uk/email-and-phone-search">Email &amp; phone search</a>
				</li>
			</ul>
</div>
	</div>
    <!-- .campl-global-header ends -->

	<div class="campl-row campl-page-header campl-sub-section-page">
		<div class="campl-wrap clearfix">
			<div class="campl-column12">
				<div class="campl-content-container">
					<div class="campl-breadcrumb" id="breadcrumb">
						<ul class="campl-unstyled-list campl-horizontal-navigation clearfix">
<li class="first-child">
								<a href="https://bioinfotraining.bio.cam.ac.uk/" class="campl-home ir">Home</a>
							</li>
							<li>
								<a href="">Courses</a>
							</li>
							<li>
								<a href="">Training Materials</a>
							</li>
							<li>
								<a href="index.html">Core Statistics in R
							</a>
</li>
						</ul>
</div>
					<!--<p class="campl-page-title">Bioinformatics Training Materials</p>-->

					<p class="campl-mobile-parent"><a href=""><span class="campl-back-btn campl-menu-indicator"></span>Studying at Cambridge</a></p>
				</div>
			</div>
		</div>
	</div>

	<div class="campl-row campl-page-header">
		<div class="campl-wrap clearfix campl-local-navigation" id="local-nav">
			<div class="campl-local-navigation-container">
				<ul class="campl-unstyled-list">
<li><a href="https://training.cam.ac.uk/bioinformatics/search">Course schedule</a></li>
					<li>
<a href="#" class="campl-selected">Additional information</a>
						<ul class="campl-unstyled-list local-dropdown-menu">
<li><a href="#">Additional resources</a></li>
							<li><a href="https://bioinfotraining.bio.cam.ac.uk/about/findus">Where to find us?</a></li>
							<li><a href="#">Frequently asked questions</a></li>
						</ul>
</li>
					<li><a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate">Further training</a></li>
				</ul>
</div>
		</div>



		<div class="campl-wrap clearfix campl-page-sub-title campl-recessed-sub-title">
			<div class="campl-column12">
				<div class="campl-content-container">
					<p class="campl-sub-title">Core Statistics in R</p>
				</div>
			</div>
		</div>
	</div>


		<div class="campl-row campl-content campl-recessed-content">
			<div class="campl-wrap clearfix">
				<div class="campl-column9  campl-main-content" id="content">
					<div class="campl-content-container">
						<div>
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <br><button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Overview</a></li>
<li class="book-part">CoreStats 1: Simple hypothesis testing</li>
<li><a class="" href="cs1-intro.html"><span class="header-section-number">2</span> Introduction</a></li>
<li class="book-part">CoreStats 1 (Practicals)</li>
<li><a class="" href="introduction.html"><span class="header-section-number">3</span> Introduction</a></li>
<li><a class="" href="cs1-one-sample-t-test.html"><span class="header-section-number">4</span> One-sample t-test</a></li>
<li><a class="" href="cs1-onesample-wilcoxon-signed-rank.html"><span class="header-section-number">5</span> Wilcoxon signed-rank test</a></li>
<li><a class="" href="cs1-students-t-test.html"><span class="header-section-number">6</span> Student’s t-test</a></li>
<li><a class="" href="cs1-mannwhitney-u-test.html"><span class="header-section-number">7</span> Mann-Whitney U test</a></li>
<li><a class="" href="cs1-paired-two-sample-t-test.html"><span class="header-section-number">8</span> Paired two-sample t-test</a></li>
<li><a class="" href="cs1-twosample-wilcoxon-signed-rank.html"><span class="header-section-number">9</span> Wilcoxon signed-rank test</a></li>
<li class="book-part">CoreStats 2: Categorical predictors</li>
<li><a class="" href="cs2-intro.html"><span class="header-section-number">10</span> Introduction</a></li>
<li class="book-part">CoreStats 2 (Practicals)</li>
<li><a class="" href="introduction-1.html"><span class="header-section-number">11</span> Introduction</a></li>
<li><a class="" href="cs2-anova.html"><span class="header-section-number">12</span> ANOVA</a></li>
<li><a class="" href="kruskal-wallis-test.html"><span class="header-section-number">13</span> Kruskal-Wallis test</a></li>
<li class="book-part">CoreStats 3: Continuous predictors</li>
<li><a class="" href="cs3-intro.html"><span class="header-section-number">14</span> Introduction</a></li>
<li class="book-part">CoreStats 3 (Practicals)</li>
<li><a class="" href="introduction-2.html"><span class="header-section-number">15</span> Introduction</a></li>
<li><a class="" href="correlation-coefficients.html"><span class="header-section-number">16</span> Correlation coefficients</a></li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">17</span> Linear regression</a></li>
<li class="book-part">CoreStats 4: Two predictor variables</li>
<li><a class="" href="cs4-intro.html"><span class="header-section-number">18</span> Introduction</a></li>
<li class="book-part">CoreStats 4 (Practicals)</li>
<li><a class="" href="introduction-3.html"><span class="header-section-number">19</span> Introduction</a></li>
<li><a class="active" href="two-way-anova.html"><span class="header-section-number">20</span> Two-way ANOVA</a></li>
<li><a class="" href="linear-regression-with-grouped-data.html"><span class="header-section-number">21</span> Linear regression with grouped data</a></li>
<li class="book-part">CoreStats 5: Multiple predictor variables</li>
<li><a class="" href="cs5-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li class="book-part">CoreStats 5 (Practicals)</li>
<li><a class="" href="introduction-4.html"><span class="header-section-number">23</span> Introduction</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">24</span> Linear models</a></li>
<li><a class="" href="model-comparisons.html"><span class="header-section-number">25</span> Model comparisons</a></li>
<li class="book-part">CoreStats 6: Power analysis</li>
<li><a class="" href="cs6-intro.html"><span class="header-section-number">26</span> Introduction</a></li>
<li class="book-part">CoreStats 6 (Practicals)</li>
<li><a class="" href="introduction-5.html"><span class="header-section-number">27</span> Introduction</a></li>
<li><a class="" href="power-analysis.html"><span class="header-section-number">28</span> Power analysis</a></li>
<li><a class="" href="statistical-reporting.html"><span class="header-section-number">29</span> Statistical reporting</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="two-way-anova" class="section level1" number="20">
<h1>
<span class="header-section-number">20</span> Two-way ANOVA<a class="anchor" aria-label="anchor" href="#two-way-anova"><i class="fas fa-link"></i></a>
</h1>
<div id="objectives-8" class="section level2" number="20.1">
<h2>
<span class="header-section-number">20.1</span> Objectives<a class="anchor" aria-label="anchor" href="#objectives-8"><i class="fas fa-link"></i></a>
</h2>
<div class="objectives">
<p><strong>Questions</strong></p>
<ul>
<li>When is the use of a two-way ANOVA appropriate?</li>
<li>How do I perform this in R?</li>
</ul>
<p><strong>Objectives</strong></p>
<ul>
<li>Be able to perform a two-way ANOVA in R</li>
<li>Understand the concept of interaction between two predictor variables</li>
<li>Be able to plot interactions in R</li>
</ul>
</div>
</div>
<div id="purpose-and-aim-6" class="section level2" number="20.2">
<h2>
<span class="header-section-number">20.2</span> Purpose and aim<a class="anchor" aria-label="anchor" href="#purpose-and-aim-6"><i class="fas fa-link"></i></a>
</h2>
<p>A two-way analysis of variance is used when we have two categorical predictor variables (or factors) and a single continuous response variable. For example, when we are looking at how body <code>Weight</code> (continuous response variable in kilograms) is affected by gender (categorical variable, <code>Male</code> or <code>Female</code>) and exercise type (categorical variable, <code>Control</code> or <code>Runner</code>).</p>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<p>When analysing these type of data there are two things we want to know:</p>
<ol style="list-style-type: decimal">
<li>Does either of the predictor variables have an effect on the response variable i.e. does gender affect body weight? Or does being a runner affect body weight?</li>
<li>Is there any <strong>interaction</strong> between the two predictor variables? An interaction would mean that the effect that exercise has on your weight depends on whether you are male or female rather than being independent of your gender. For example if being male means that runners weigh more than non-runners, but being female means that runners weight less than non-runners then we would say that there was an interaction.</li>
</ol>
<p>We will first consider how to visualise the data before then carrying out an appropriate statistical test.</p>
</div>
<div id="section-commands-10" class="section level2" number="20.3">
<h2>
<span class="header-section-number">20.3</span> Section commands<a class="anchor" aria-label="anchor" href="#section-commands-10"><i class="fas fa-link"></i></a>
</h2>
<p>New commands used in this section:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Function</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot()</a></code></td>
<td align="left">Creates a boxplot</td>
</tr>
<tr class="even">
<td align="left"><code><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot()</a></code></td>
<td align="left">Creates an interaction plot</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code></td>
<td align="left">Carries out an ANOVA test</td>
</tr>
</tbody>
</table></div>
</div>
<div id="data-and-hypotheses-9" class="section level2" number="20.4">
<h2>
<span class="header-section-number">20.4</span> Data and hypotheses<a class="anchor" aria-label="anchor" href="#data-and-hypotheses-9"><i class="fas fa-link"></i></a>
</h2>
<p>We will recreate the example analysis used in the lecture. The data are stored as a .csv file called <code>CS4-exercise.csv</code>.</p>
</div>
<div id="summarise-and-visualise-9" class="section level2" number="20.5">
<h2>
<span class="header-section-number">20.5</span> Summarise and visualise<a class="anchor" aria-label="anchor" href="#summarise-and-visualise-9"><i class="fas fa-link"></i></a>
</h2>
<p><code>Experiment</code> is a dataframe with three variables; <code>Weight</code>, <code>Gender</code> and <code>Exercise.</code> <code>Weight</code> is the continuous response variable, whereas <code>Gender</code> and <code>Exercise</code> are the categorical predictor variables.</p>
<p>First, read in the data:</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/raw/CS4-exercise.csv"</span><span class="op">)</span></code></pre></div>
<p>Then visualise:</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">Gender</span>, data <span class="op">=</span> <span class="va">Experiment</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">Exercise</span>, data <span class="op">=</span> <span class="va">Experiment</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-5-2.png" width="672"></div>
<p>These produce basic box plots showing the response variable (<code>Weight</code>) only in terms of one of the predictor variables. The values of the other predictor variable in each case aren’t taken into account. The argument <code>Weight ~ Gender</code> (or <code>Weight ~ Exercise</code>) is key here. It tells R to treat <code>Weight</code> as a function of <code>Gender</code> only (or as a function of <code>Exercise</code> only.)
These are also very basic plots just showing the raw data and using default arguments.</p>
<p>(Optional) Add titles, axis labels and any other information that you see fit to the plots to make them presentable.</p>
<p>Visualise both predictor variables together:</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">Gender</span> <span class="op">+</span> <span class="va">Exercise</span>, data <span class="op">=</span> <span class="va">Experiment</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-6-1.png" width="672"></div>
<p>This produces box plots for all (four) combinations of the predictor variables. The key argument here is <code>Weight ~ Gender + Exercise</code>. This tells R to treat <code>Weight</code> as a function of both <code>Gender</code> and <code>Exercise.</code> The + symbol does not mean to add the numbers together, but that <code>Weight</code> should be treated as a function of <code>Gender</code> plus <code>Exercise.</code>
Again, this is a very basic plot that just shows the raw data and uses default arguments.</p>
<p>(Optional) Add titles, axis labels and any other information that you see fit to the plot to make it presentable.</p>
<p>In this example there are only four box plots and so it is relatively easy to compare them and look for any interactions between variables, but if there were more than two levels (groups) per categorical variable, it would become harder to spot what was going on. To compare categorical variables more easily we just plot the group means which aids our ability to look for interactions and the main effects of each predictor variable.</p>
<p>Create an interaction plot:</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot</a></span><span class="op">(</span><span class="va">Experiment</span><span class="op">$</span><span class="va">Gender</span>,
                 <span class="va">Experiment</span><span class="op">$</span><span class="va">Exercise</span>,
                 <span class="va">Experiment</span><span class="op">$</span><span class="va">Weight</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
<ul>
<li>The first argument defines the categorical variable that will be used for the horizontal axis. This must be a factor vector (if it comes from a data.frame then it will automatically be a factor). In this function this is called the <code>x.factor</code>.</li>
<li>The second argument defines the categorical variable that will be used for the different lines to be plotted. This must be a factor vector. In this function this is called the <code>trace.factor</code>.</li>
<li>The third argument defines the response variable that will be used for the vertical axis. This must be a numerical vector. In this function this argument is called the <code>response</code>.</li>
</ul>
<p>It’s common to get the order of these arguments muddled up. Remember that it’s the <strong>third argument</strong> that defines the variable that goes on the vertical axis!</p>
<p>The default settings aren’t too great for displaying interaction plots. Try the following for (in my opinion) a more user-friendly display.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot</a></span><span class="op">(</span><span class="va">Experiment</span><span class="op">$</span><span class="va">Gender</span>,
                 <span class="va">Experiment</span><span class="op">$</span><span class="va">Exercise</span>,
                 <span class="va">Experiment</span><span class="op">$</span><span class="va">Weight</span>,
                 xlab <span class="op">=</span> <span class="st">"Gender"</span>, ylab <span class="op">=</span> <span class="st">"Weight"</span>,
                 trace.label <span class="op">=</span> <span class="st">"Exercise"</span>,
                 type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">4</span>,
                 col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
<p>The choice of which categorical factor is plotted on the horizontal axis and which is plotted as different lines is completely arbitrary. Looking at the data both ways shouldn’t add anything but often you’ll find that you prefer one plot to another.</p>
<p>Plot the interaction plot the other way round:</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot</a></span><span class="op">(</span><span class="va">Experiment</span><span class="op">$</span><span class="va">Exercise</span>,
                 <span class="va">Experiment</span><span class="op">$</span><span class="va">Gender</span>,
                 <span class="va">Experiment</span><span class="op">$</span><span class="va">Weight</span>,
                 xlab <span class="op">=</span> <span class="st">"Gender"</span>, ylab <span class="op">=</span> <span class="st">"Weight"</span>,
                 trace.label <span class="op">=</span> <span class="st">"Exercise"</span>,
                 type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">4</span>,
                 col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<p>By now you should have a good feeling for the data and could already provide some guesses to the following three questions:</p>
<ul>
<li>Does there appear to be any interaction between the two categorical variables?</li>
<li>If not:
<ul>
<li>Does <code>Exercise</code> have an effect on <code>Weight</code>?</li>
<li>Does <code>Gender</code> have an effect on <code>Weight</code>?</li>
</ul>
</li>
</ul>
<p>We can now attempt to answer these three questions more formally using an ANOVA test. We have to ask R explicitly to test for three things: the interaction, the effect of <code>Exercise</code> and the effect of <code>Gender.</code></p>
</div>
<div id="assumptions-9" class="section level2" number="20.6">
<h2>
<span class="header-section-number">20.6</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions-9"><i class="fas fa-link"></i></a>
</h2>
<p>Before we can formally test these things we first need to define the model and check the underlying assumptions. We use the following code to define the model:</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define the linear model</span>
<span class="va">lm.exercise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">Gender</span> <span class="op">+</span> <span class="va">Exercise</span> <span class="op">+</span> <span class="va">Gender</span><span class="op">:</span><span class="va">Exercise</span>,
                  data <span class="op">=</span> <span class="va">Experiment</span><span class="op">)</span></code></pre></div>
<p>The <code>Gender:Exercise</code> term is how R represents the concept of an interaction between these two variables.</p>
<p>As the two-way ANOVA is a type of linear model we need to satisfy pretty much the same assumptions as we did for a simple linear regression or a one-way ANOVA:</p>
<ol style="list-style-type: decimal">
<li>The data must not have any systematic pattern to it</li>
<li>The residuals must be normally distributed</li>
<li>The residuals must have homogeneity of variance</li>
<li>The fit should not depend overly much on a single point (no point should have high leverage).</li>
</ol>
<p>Again, we will check these assumptions visually by producing four key diagnostic plots.</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm.exercise</span><span class="op">)</span></code></pre></div>
<pre><code>## hat values (leverages) are all = 0.2
##  and there are no factor predictors; no plot no. 5</code></pre>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-11-1.png" width="672"></div>
<ul>
<li><p>The first command changes the plotting parameters and splits the graphics window into 2 rows and 2 columns (you won’t notice anything whilst you run it).</p></li>
<li><p>The second command produces 3 plots in the graphics window and one warning stating that the Residuals vs Factor Levels plot is left out. This is because all of our groups have exactly the same number of data points.</p></li>
<li><p>The top left graph plots the residuals against the fitted values. There is no systematic pattern here and this plot is pretty good.</p></li>
<li><p>The top right graph allows a visual inspection of normality. Again, this looks OK (not perfect but OK).</p></li>
<li><p>The bottom left graph allows us to investigate whether there is homogeneity of variance. This plot is fine (not perfect but fine).</p></li>
</ul>
<div class="note">
<p>There is a shorthand way of writing:</p>
<p><code>Weight ~ Gender + Exercise + Gender:Exercise</code></p>
<p>If you use the following syntax:</p>
<p><code>Weight ~ Gender * Exercise</code></p>
<p>Then R interprets it exactly the same way as writing all three terms.
You can see this if you compare the output of the following two commands:</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">Gender</span> <span class="op">+</span> <span class="va">Exercise</span> <span class="op">+</span> <span class="va">Gender</span><span class="op">:</span><span class="va">Exercise</span>,
         data <span class="op">=</span> <span class="va">Experiment</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Weight
##                 Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Gender           1 607.20  607.20 43.1144 6.493e-06 ***
## Exercise         1 184.83  184.83 13.1240  0.002287 ** 
## Gender:Exercise  1  82.42   82.42  5.8521  0.027839 *  
## Residuals       16 225.34   14.08                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">Gender</span> <span class="op">*</span> <span class="va">Exercise</span>,
         data <span class="op">=</span> <span class="va">Experiment</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Weight
##                 Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Gender           1 607.20  607.20 43.1144 6.493e-06 ***
## Exercise         1 184.83  184.83 13.1240  0.002287 ** 
## Gender:Exercise  1  82.42   82.42  5.8521  0.027839 *  
## Residuals       16 225.34   14.08                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div id="implement-the-test-2" class="section level2" number="20.7">
<h2>
<span class="header-section-number">20.7</span> Implement the test<a class="anchor" aria-label="anchor" href="#implement-the-test-2"><i class="fas fa-link"></i></a>
</h2>
<p>The assumptions appear to be met well enough, meaning we can implement the ANOVA. We do this as follows (this is probably the easiest bit!):</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># perform the ANOVA</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">lm.exercise</span><span class="op">)</span></code></pre></div>
</div>
<div id="interpret-output-and-present-results" class="section level2" number="20.8">
<h2>
<span class="header-section-number">20.8</span> Interpret output and present results<a class="anchor" aria-label="anchor" href="#interpret-output-and-present-results"><i class="fas fa-link"></i></a>
</h2>
<p>Performing the ANOVA gives us the following output:</p>
<pre><code>## Analysis of Variance Table
## 
## Response: Weight
##                 Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Gender           1 607.20  607.20 43.1144 6.493e-06 ***
## Exercise         1 184.83  184.83 13.1240  0.002287 ** 
## Gender:Exercise  1  82.42   82.42  5.8521  0.027839 *  
## Residuals       16 225.34   14.08                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>We have a row in the table for each of the different effects that we’ve asked R to consider. The last column is the important one as this contains the p-values (although we will also need the F-values and the degrees of freedom for reporting purposes). We need to look at the interaction row first.</p>
<p><code>Gender:Exercise</code> has a p-value of about 0.028 (which is smaller than 0.05) and so we can conclude that the interaction between <code>Gender</code> and <code>Exercise</code> is significant.</p>
<p>This is where we must stop.</p>
<p>The top two lines (corresponding to the effects of <code>Gender</code> and <code>Exercise</code>) are meaningless now and the p-values that have been reported are utterly redundant (in particular we do not in any way care that their p-values are so small).</p>
<p>If a model has a significant interaction then it is logically impossible to meaningfully interpret the main effects.</p>
<p>We would report this as follows:</p>
<blockquote>
<p>A two-way ANOVA test showed that there was a significant interaction between the effects of Gender and Exercise on Weight (F = 5.8521, df = 1,16, p = 0.028). Exercise was associated with a small loss of weight in males but a larger loss of weight in females.</p>
</blockquote>
</div>
<div id="exercise-cells" class="section level2" number="20.9">
<h2>
<span class="header-section-number">20.9</span> Exercise: Cells<a class="anchor" aria-label="anchor" href="#exercise-cells"><i class="fas fa-link"></i></a>
</h2>
<div class="exercise">
<p><span id="exr:unlabeled-div-13" class="exercise"><strong>Exercise 20.1  </strong></span>Cell growth</p>
<p>These <code>data/raw/CS4-cells.csv</code> data are from a fictional experiment that involves looking at the effect of different concentrations of a substance on the growth rate of two different cell types (all annoyingly vague I know – suggestions for context are welcome here!). There are two cell types and three concentrations.</p>
<p>For each cell type we have a <em>control</em> experiment in which no substance is added (i.e. concentration is <code>none</code>); a <code>low</code> concentration of substance and a <code>high</code> concentration of substance. The cells are called <code>A</code> and <code>B</code>.
For each combination of cell type and substance concentration we add the substance to an individual cell in a petri dish and after 8 hours, we count the number of cells in the dish (Again this may well be biologically weird/impossible – suggestions are welcome). Each experiment is repeated three times.</p>
<p>For each cell type we have a <em>control</em> experiment in which no substance is added (i.e. concentration is <code>none</code>); a <code>low</code> concentration of substance and a <code>high</code> concentration of substance. The cells are called <code>A</code> and <code>B</code>.
For each combination of cell type and substance concentration we add the substance to an individual cell in a petri dish and after 8 hours, we count the number of cells in the dish (Again this may well be biologically weird/impossible – suggestions are welcome). Each experiment is repeated three times.</p>
<p>Questions to answer:</p>
<ul>
<li>Visualise the data using boxplots and interaction plots.</li>
<li>Does there appear to be any interaction?</li>
<li>Carry out a two-way ANOVA test.</li>
<li>Check the assumptions.</li>
<li>What can you conclude? (Write a sentence to summarise).</li>
</ul>
<details><summary>
Answer
</summary><div id="load-the-data" class="section level3" number="20.9.1">
<h3>
<span class="header-section-number">20.9.1</span> Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read in the data</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/raw/CS4-cells.csv"</span><span class="op">)</span>

<span class="co"># let's have a peek at the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cells</span><span class="op">)</span></code></pre></div>
<pre><code>##   id cell_type concentration cell_number
## 1  1         A          none           7
## 2  2         A          none           9
## 3  3         A          none           4
## 4  4         B          none           5
## 5  5         B          none           8
## 6  6         B          none           9</code></pre>
</div>
<div id="visualise-the-data" class="section level3" number="20.9.2">
<h3>
<span class="header-section-number">20.9.2</span> Visualise the data<a class="anchor" aria-label="anchor" href="#visualise-the-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">cell_number</span> <span class="op">~</span> <span class="va">concentration</span>,
        data <span class="op">=</span> <span class="va">cells</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-16-1.png" width="672"></div>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">cell_number</span> <span class="op">~</span> <span class="va">cell_type</span>,
        data <span class="op">=</span> <span class="va">cells</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-16-2.png" width="672"></div>
<p>Let’s look at the interaction plots:</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># by cell type</span>
<span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot</a></span><span class="op">(</span><span class="va">cells</span><span class="op">$</span><span class="va">concentration</span>,
                 <span class="va">cells</span><span class="op">$</span><span class="va">cell_type</span>,
                 <span class="va">cells</span><span class="op">$</span><span class="va">cell_number</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-17-1.png" width="672"></div>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># by concentration</span>
<span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot</a></span><span class="op">(</span><span class="va">cells</span><span class="op">$</span><span class="va">cell_type</span>,
                 <span class="va">cells</span><span class="op">$</span><span class="va">concentration</span>,
                 <span class="va">cells</span><span class="op">$</span><span class="va">cell_number</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-17-2.png" width="672"></div>
<p>We’re constructed both box plots and we’ve also constructed two interaction plots. We only needed to do one interaction plot but I find it can be quite useful to look at the data from different angles. Both interaction plots suggest that there is an interaction here as the lines in the plots aren’t parallel. Looking at the interaction plot with <code>concentration</code> on the x-axis, it appears that there is non-difference between cell types when the concentration is <code>none</code>, but that there is a difference between cell types when the concentration is <code>low</code> or <code>high</code>.</p>
</div>
<div id="assumptions-10" class="section level3" number="20.9.3">
<h3>
<span class="header-section-number">20.9.3</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions-10"><i class="fas fa-link"></i></a>
</h3>
<p>First we need to define the model:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define the linear model, with interaction term</span>
<span class="va">lm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">cell_number</span> <span class="op">~</span> <span class="va">concentration</span> <span class="op">*</span> <span class="va">cell_type</span>,
          data <span class="op">=</span> <span class="va">cells</span><span class="op">)</span></code></pre></div>
<p>Next, we check the assumptions:</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm1</span><span class="op">)</span></code></pre></div>
<pre><code>## hat values (leverages) are all = 0.3333333
##  and there are no factor predictors; no plot no. 5</code></pre>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-19-1.png" width="672"></div>
<p>So, these actually all look pretty good, although at first glance you might be a bit worried by some apparent heterogeneity of variance. The last group in the <code>Residuals vs fitted</code> graph does appear to be more spread out then the other 5 groups. This is echoed in the <code>Scale-Location</code> graph, where the red line kicks up at the end. Whilst this does technically signify that there is heterogeneity of variance we aren’t too worried by this because there are only three data points per group. Because of this low number of data points per group when we get one data point that is a little bit more extreme than the others (purely by chance) then this has a large impact on our perception of the homogeneity of variance. If there were more data points in each group then we would be more certain that any observed heterogeneity of variance was a true feature of the underlying parent population (and therefore a problem) rather than just being caused by a single random point (and therefore not a problem).</p>
</div>
<div id="implement-the-test-3" class="section level3" number="20.9.4">
<h3>
<span class="header-section-number">20.9.4</span> Implement the test<a class="anchor" aria-label="anchor" href="#implement-the-test-3"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s carry out a two-way ANOVA:</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># perform the ANOVA</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">lm1</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: cell_number
##                         Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## concentration            2 10932.1  5466.1 537.645 1.807e-12 ***
## cell_type                1  1152.0  1152.0 113.311 1.816e-07 ***
## concentration:cell_type  2  1158.3   579.2  56.967 7.485e-07 ***
## Residuals               12   122.0    10.2                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div id="interpret-the-output-and-report-the-results" class="section level3" number="20.9.5">
<h3>
<span class="header-section-number">20.9.5</span> Interpret the output and report the results<a class="anchor" aria-label="anchor" href="#interpret-the-output-and-report-the-results"><i class="fas fa-link"></i></a>
</h3>
<p>There is definitely a significant interaction between <code>concentration</code> and <code>cell_type</code>.</p>

</div>
</details>
</div>
</div>
<div id="exercise-tulips" class="section level2" number="20.10">
<h2>
<span class="header-section-number">20.10</span> Exercise: Tulips<a class="anchor" aria-label="anchor" href="#exercise-tulips"><i class="fas fa-link"></i></a>
</h2>
<div class="exercise">
<p><span id="exr:unlabeled-div-14" class="exercise"><strong>Exercise 20.2  </strong></span>Blooms and growing conditions</p>
<p>The <code>data/raw/CS4-tulip.csv</code> dataset contains information on an experiment to determine the best conditions for growing tulips (well someone has to care about these sorts of things!). The average number of flower heads (blooms) were recorded for 27 different plots. Each plot experienced one of three different watering regimes and one of three different shade regimes.</p>
<ul>
<li>Investigate how the number of blooms is affected by different growing conditions.</li>
</ul>
<details><summary>
Answer
</summary><div id="load-the-data-1" class="section level3" number="20.10.1">
<h3>
<span class="header-section-number">20.10.1</span> Load the data<a class="anchor" aria-label="anchor" href="#load-the-data-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read in the data</span>
<span class="va">tulip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/raw/CS4-tulip.csv"</span><span class="op">)</span>

<span class="co"># have a quick look at the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tulip</span><span class="op">)</span></code></pre></div>
<pre><code>##   Water Shade Blooms
## 1     1     1   0.00
## 2     1     2   0.00
## 3     1     3 111.04
## 4     2     1 183.47
## 5     2     2  59.16
## 6     2     3  76.75</code></pre>
<p>This dataset has three variables; <code>Blooms</code> (which is the response variable) and <code>Water</code> and <code>Shade</code> (which are the two potential predictor variables).</p>
</div>
<div id="visualise-the-data-1" class="section level3" number="20.10.2">
<h3>
<span class="header-section-number">20.10.2</span> Visualise the data<a class="anchor" aria-label="anchor" href="#visualise-the-data-1"><i class="fas fa-link"></i></a>
</h3>
<p>As always we’ll visualise the data first:</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">Blooms</span> <span class="op">~</span> <span class="va">Water</span>, data <span class="op">=</span> <span class="va">tulip</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-22-1.png" width="672"></div>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">Blooms</span> <span class="op">~</span> <span class="va">Shade</span>, data <span class="op">=</span> <span class="va">tulip</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-22-2.png" width="672"></div>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot</a></span><span class="op">(</span><span class="va">tulip</span><span class="op">$</span><span class="va">Water</span>,
                 <span class="va">tulip</span><span class="op">$</span><span class="va">Shade</span>,
                 <span class="va">tulip</span><span class="op">$</span><span class="va">Blooms</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-22-3.png" width="672"></div>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot</a></span><span class="op">(</span><span class="va">tulip</span><span class="op">$</span><span class="va">Shade</span>,
                 <span class="va">tulip</span><span class="op">$</span><span class="va">Water</span>,
                 <span class="va">tulip</span><span class="op">$</span><span class="va">Blooms</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-22-4.png" width="672"></div>
<p>Again, both interaction plots suggest that there might be an interaction here. Digging in a little deeper from a descriptive perspective, it looks as though that <code>Water</code> regime 1 is behaving differently to <code>Water</code> regimes 2 and 3 under different shade conditions.</p>
</div>
<div id="assumptions-11" class="section level3" number="20.10.3">
<h3>
<span class="header-section-number">20.10.3</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions-11"><i class="fas fa-link"></i></a>
</h3>
<p>First we need to define the model:</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define the linear model</span>
<span class="va">lm.tulip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Blooms</span> <span class="op">~</span> <span class="va">Water</span> <span class="op">*</span> <span class="va">Shade</span>,
               data <span class="op">=</span> <span class="va">tulip</span><span class="op">)</span></code></pre></div>
<p>Next, we check the assumptions:</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm.tulip</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="cs4-practical-two_way_anova_files/figure-html/unnamed-chunk-24-1.png" width="672"></div>
<p>These are actually all OK. Point number 8 is messing with the homogeneity of variance assumption a little bit, but since it’s only one point we won’t worry about it. A two-way ANOVA analysis is still on the cards.</p>
</div>
<div id="implement-the-test-4" class="section level3" number="20.10.4">
<h3>
<span class="header-section-number">20.10.4</span> Implement the test<a class="anchor" aria-label="anchor" href="#implement-the-test-4"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s carry out the two-way ANOVA.</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># perform the ANOVA</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">lm.tulip</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Blooms
##             Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Water        1 103426  103426  43.057 1.075e-06 ***
## Shade        1  31154   31154  12.970  0.001505 ** 
## Water:Shade  1  33520   33520  13.954  0.001082 ** 
## Residuals   23  55248    2402                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div id="interpret-the-output-and-report-results" class="section level3" number="20.10.5">
<h3>
<span class="header-section-number">20.10.5</span> Interpret the output and report results<a class="anchor" aria-label="anchor" href="#interpret-the-output-and-report-results"><i class="fas fa-link"></i></a>
</h3>
<p>So we do appear to have a significant interaction between <code>Water</code> and <code>Shade</code> as expected.</p>

</div>
</details>
</div>
</div>
<div id="key-points-6" class="section level2" number="20.11">
<h2>
<span class="header-section-number">20.11</span> Key points<a class="anchor" aria-label="anchor" href="#key-points-6"><i class="fas fa-link"></i></a>
</h2>
<div class="keypoints">
<ul>
<li>A two-way ANOVA is used when there are two categorical variables and a single continuous variable</li>
<li>We can visually check for interactions between the categorical variables by using <code><a href="https://rdrr.io/r/stats/interaction.plot.html">interaction.plot()</a></code>
</li>
<li>The two-way ANOVA is a type of linear model and assumes the following:
<ol style="list-style-type: decimal">
<li>the data have no systematic pattern</li>
<li>the residuals are normally distributed</li>
<li>the residuals have homogeneity of variance</li>
<li>the fit does not depend on a single point (no single point has high leverage)</li>
</ol>
</li>
</ul>
</div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="introduction-3.html"><span class="header-section-number">19</span> Introduction</a></div>
<div class="next"><a href="linear-regression-with-grouped-data.html"><span class="header-section-number">21</span> Linear regression with grouped data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#two-way-anova"><span class="header-section-number">20</span> Two-way ANOVA</a></li>
<li><a class="nav-link" href="#objectives-8"><span class="header-section-number">20.1</span> Objectives</a></li>
<li><a class="nav-link" href="#purpose-and-aim-6"><span class="header-section-number">20.2</span> Purpose and aim</a></li>
<li><a class="nav-link" href="#section-commands-10"><span class="header-section-number">20.3</span> Section commands</a></li>
<li><a class="nav-link" href="#data-and-hypotheses-9"><span class="header-section-number">20.4</span> Data and hypotheses</a></li>
<li><a class="nav-link" href="#summarise-and-visualise-9"><span class="header-section-number">20.5</span> Summarise and visualise</a></li>
<li><a class="nav-link" href="#assumptions-9"><span class="header-section-number">20.6</span> Assumptions</a></li>
<li><a class="nav-link" href="#implement-the-test-2"><span class="header-section-number">20.7</span> Implement the test</a></li>
<li><a class="nav-link" href="#interpret-output-and-present-results"><span class="header-section-number">20.8</span> Interpret output and present results</a></li>
<li>
<a class="nav-link" href="#exercise-cells"><span class="header-section-number">20.9</span> Exercise: Cells</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-the-data"><span class="header-section-number">20.9.1</span> Load the data</a></li>
<li><a class="nav-link" href="#visualise-the-data"><span class="header-section-number">20.9.2</span> Visualise the data</a></li>
<li><a class="nav-link" href="#assumptions-10"><span class="header-section-number">20.9.3</span> Assumptions</a></li>
<li><a class="nav-link" href="#implement-the-test-3"><span class="header-section-number">20.9.4</span> Implement the test</a></li>
<li><a class="nav-link" href="#interpret-the-output-and-report-the-results"><span class="header-section-number">20.9.5</span> Interpret the output and report the results</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exercise-tulips"><span class="header-section-number">20.10</span> Exercise: Tulips</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-the-data-1"><span class="header-section-number">20.10.1</span> Load the data</a></li>
<li><a class="nav-link" href="#visualise-the-data-1"><span class="header-section-number">20.10.2</span> Visualise the data</a></li>
<li><a class="nav-link" href="#assumptions-11"><span class="header-section-number">20.10.3</span> Assumptions</a></li>
<li><a class="nav-link" href="#implement-the-test-4"><span class="header-section-number">20.10.4</span> Implement the test</a></li>
<li><a class="nav-link" href="#interpret-the-output-and-report-results"><span class="header-section-number">20.10.5</span> Interpret the output and report results</a></li>
</ul>
</li>
<li><a class="nav-link" href="#key-points-6"><span class="header-section-number">20.11</span> Key points</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

					</div>
				</div>
				<!-- Related links -->
				<!--<div class="campl-column3 campl-secondary-content">
					<div class="campl-content-container">
						<div class="campl-heading-container">
							<h2>Related Links</h2>
						</div>
						<ul class='campl-unstyled-list campl-related-links'>
							<li><a href="#">Lorem ipsum dolor sit amet</a></li>
							<li><a href="#">Consectetur adipisicing elit</a></li>
							<li><a href="#">Sed do eiusmod tempor incididunt extra long wrapping on to two line</a></li>
							<li><a href="#">Labore et dolore magna aliqua</a></li>
							<li><a href="#">Ut enim ad minim veniam</a></li>
							<li><a href="#">Quis nostrud exercitation ullamco</a></li>
						</ul>
					</div>
					<div class="campl-content-container">
						<div class="campl-vertical-teaser campl-teaser campl-promo-teaser">
							<div class="campl-content-container campl-vertical-teaser-txt">
								<p class='campl-teaser-title'><a href="#">Promo teaser with title above</a></p>
							</div>
							<div class="campl-content-container campl-vertical-teaser-img">
								<a href="#" class="campl-teaser-img-link"><img alt=""  src="images/content/homepage-promo-placeholder.png" class="campl-scale-with-grid" /></a>
							</div>
							<div class="campl-content-container campl-vertical-teaser-txt clearfix">
								<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </p>
								<a href="#4" class="campl-secondary-cta campl-float-right">Read more</a>
							</div>
						</div>
					</div>
				</div>-->
			</div>
		</div>
		<div class="campl-row campl-local-footer">
			<div class="campl-wrap clearfix">
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Contact us</h3>
						 <div class="content">
						   <p>Bioinformatics Training Department of Genetics University of Cambridge Downing Street Cambridge CB2 3EH United Kingdom</p>
						   <h3>Contact:</h3> <a href="mailto:%20bioinfotraining@bio.cam.ac.uk">bioinfotraining@bio.cam.ac.uk</a>
						 </div>
					</div>
				</div>
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Bioinformatics Training</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/undergraduate">Undergraduate training</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate">Postgraduate training</a>
							</li>
						</ul>
</div>
				</div>
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Postgraduate Courses by Theme</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/programming">Basic Skills and Programming</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/services">Databases and Services</a>
							</li>
							<li>
							  <a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/specialized">Specialised Topics</a>
							</li>
						</ul>
</div>
				</div>
				<div class="campl-column3 campl-footer-navigation last">
					<div class="campl-content-container campl-navigation-list">
						<h3>About Bioinformatics Training</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about">About the Facility</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about/findus">How to find us</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about/visitors">Visiting Cambridge</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/privacy-and-cookie-policies">Privacy and Cookies policy</a>
							</li>
						</ul>
</div>
				</div>
			</div>
		</div>
	<div class="campl-row campl-global-footer">
		<div class="campl-wrap clearfix">
			<div class="campl-column3 campl-footer-navigation">
				<div class="campl-content-container campl-footer-logo">
					<img alt="University of Cambridge" src="images/interface/main-logo-small.png" height="38px;" class="campl-scale-with-grid"><p>© 2021 University of Cambridge</p>
						<ul class="campl-unstyled-list campl-global-footer-links">
<li>
								<a href="http://www.cam.ac.uk/university-a-z">University A-Z</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/contact-the-university">Contact the University</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/about-this-site/accessibility">Accessibility</a>
							</li>
							<li>
								<a href="http://www.admin.cam.ac.uk/univ/information/foi/">Freedom of information</a>
							</li>
							<li>
								<a href="http://www.cam.ac.uk/about-this-site/terms-and-conditions">Terms and conditions</a>
							</li>
						</ul>
</div>
			</div>
			<div class="campl-column3 campl-footer-navigation">
				<div class="campl-content-container campl-navigation-list">

					<div class="link-list">
						<h3><a href="http://www.cam.ac.uk/study-at-cambridge">Study at Cambridge</a></h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="http://www.study.cam.ac.uk/undergraduate/">Undergraduate</a>
							</li>
							<li>
								<a href="http://www.graduate.study.cam.ac.uk/">Graduate</a>
							</li>
							<li>
								<a href="http://www.internationalstudents.cam.ac.uk">International students</a>
							</li>
							<li>
								<a href="http://www.ice.cam.ac.uk">Continuing education</a>
							</li>
							<li>
								<a href="http://www.epe.admin.cam.ac.uk/">Executive and professional education</a>
							</li>
							<li>
								<a href="http://www.educ.cam.ac.uk">Courses in education</a>
							</li>
						</ul>
</div>
				</div>
			</div>
			<div class="campl-column3 campl-footer-navigation">
				<div class="campl-content-container campl-navigation-list">
					<h3><a href="http://www.cam.ac.uk/about-the-university">About the University</a></h3>
					<ul class="campl-unstyled-list campl-page-children">
<li>
							<a href="http://www.cam.ac.uk/about-the-university/how-the-university-and-colleges-work">How the University and Colleges work</a>
						</li>
						<li>
							<a href="http://www.cam.ac.uk/about-the-university/visiting-the-university">Visiting the University</a>
						</li>
						<li>
							<a href="http://map.cam.ac.uk">Map</a>
						</li>
						<li>
							<a href="http://www.cam.ac.uk/news">News</a>
						</li>
						<li>
							<a href="http://www.admin.cam.ac.uk/whatson/">Events</a>
						</li>
						<li>
							<a href="http://www.jobs.cam.ac.uk">Jobs</a>
						</li>
						<li>
							<a href="https://www.philanthropy.cam.ac.uk/">Give to Cambridge</a>
						</li>
					</ul>
</div>
			</div>
			<div class="campl-column3 campl-footer-navigation last">
				<div class="campl-content-container campl-navigation-list">
					<h3><a href="http://www.cam.ac.uk/research">Research at Cambridge</a></h3>
					<ul class="campl-unstyled-list">
<li>
							<a href="http://www.cam.ac.uk/research/news">News</a>
						</li>
						<li>
							<a href="http://www.cam.ac.uk/research/features">Features</a>
						</li>
						<li>
							<a href="http://www.cam.ac.uk/research/discussion">Discussion</a>
						</li>
						<li>
							<a href="http://www.cam.ac.uk/research/spotlight-on">Spotlight on...</a>
						</li>
						<li>
							<a href="http://www.cam.ac.uk/research/research-at-cambridge">About research at Cambridge</a>
						</li>
					</ul>
</div>
			</div>
		</div>
	</div>
	<!-- .campl-global-footer ends -->

<!--[if lte IE 8]>
</div>
<![endif]-->

	<script type="text/javascript" src="javascripts/libs/ios-orientationchange-fix.js"></script><script type="text/javascript" src="javascripts/libs/jquery-min.js"></script><script type="text/javascript" src="javascripts/libs/modernizr.js"></script><script type="text/javascript" src="javascripts/custom.js"></script><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
